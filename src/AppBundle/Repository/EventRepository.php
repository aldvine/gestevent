<?php

namespace AppBundle\Repository;

/**
 * EventRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class EventRepository extends \Doctrine\ORM\EntityRepository
{

    // requete sql sur mesure;

    /**
     * @param $date
     * @return Event[]
     */
    public function findAllGreaterThanDate($date)
    {

        $qb = $this->createQueryBuilder('e')
            ->andWhere('e.date > :date')
            ->setParameter('date', $date)
            ->getQuery();

        return $qb->execute();


    }

    
    // nouveau filtre 
    /**
     * @param $date,$theme
     * @return Event[]
     */
    public function findByFilter($dateNow, $title, $place, $date, $theme)
    {
        $qb = $this->createQueryBuilder('e')
            ->where('e.date > :dateNow ')->setParameter('dateNow', $dateNow);
        if (!empty($date)) {
            $qb = $qb->andWhere('e.date = :date')->setParameter('date', $date);
        }
        if (!empty($title)) {
            $qb = $qb->andWhere('lower(e.title) like lower(:title)')->setParameter('title', "%" . $title . "%");
        }
        if (!empty($theme)) {
            $qb = $qb->andWhere('lower(e.theme) like lower(:theme)')->setParameter('theme', "%" . $theme . "%");
        }
        if (!empty($place)) {
            $qb = $qb->andWhere('lower(e.place) like lower(:place)')->setParameter('place', "%" . $place . "%");
        }
        $qb = $qb->getQuery();
        return $qb->execute();
    }
    // par utilisateur
    /**
     * @param $date,$user
     * @return Event[]
     */
    public function findByUser($dateNow,$user)
    {
        $qb = $this->createQueryBuilder('e')
        ->andWhere('e.user = :user')
        ->setParameter('user', $user)
        ->getQuery();
        return $qb->execute();
    }

    // // plus utilisé
    // /**
    //  * @param $date,$place
    //  * @return Event[]
    //  */
    // public function findByPlace($date,$place)
    // {

    //     $qb = $this->createQueryBuilder('e')
    //         ->where('e.date > :date')
    //         ->andWhere('e.place like :place')
    //         ->setParameter('date',$date )
    //         ->setParameter('place',"%".$place."%" )
    //         ->getQuery();

    //     return $qb->execute();

    // }


    //  // plus utilisé
    // /**
    //  * @param $date,$theme
    //  * @return Event[]
    //  */
    // public function findByTheme($date,$theme)
    // {
   
    //     $qb = $this->createQueryBuilder('e')
    //         ->where('e.date > :date')
    //         ->andWhere('e.theme like :theme')
    //         ->setParameter('date',$date )
    //         ->setParameter('theme',"%".$theme."%" )
    //         ->getQuery();

    //     return $qb->execute();

    // }


}
